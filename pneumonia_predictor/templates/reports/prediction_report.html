<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    /* Keep styles conservative for xhtml2pdf compatibility */
    @page { margin:18px; }
    body{
      font-family: DejaVu Sans, Arial, sans-serif;
      font-size:12px;
      color:#222;
      margin:0;
      padding:0;
    }

    .container{ width:100%; padding:12px; box-sizing:border-box; }

    .header{
      width:100%;
      border-bottom:1px solid #e6eef8;
      padding-bottom:10px;
      margin-bottom:12px;
    }

    .header-table{ width:100%; border-collapse:collapse; }
    .header-table td{ vertical-align:middle; }
    .logo {
      width:64px;
      height:64px;
      background: linear-gradient(90deg,#2563eb,#06b6d4);
      color:#fff;
      font-weight:700;
      text-align:center;
      line-height:64px;
      border-radius:6px;
      font-size:18px;
    }
    .title {
      font-size:16px;
      font-weight:700;
      color:#0f172a;
    }
    .sub { font-size:11px; color:#6b7280; margin-top:4px; }

    .meta-row { margin-top:8px; }

    /* two-column layout using table for pdf compatibility */
    .content-table{ width:100%; border-collapse:collapse; margin-top:10px; }
    .content-table td{ vertical-align:top; padding:6px; }

    .left-col{ width:60%; padding-right:8px; }
    .right-col{ width:40%; text-align:center; }

    .box {
      border:1px solid #eef6ff;
      background:#fbfdff;
      padding:8px;
      border-radius:6px;
      margin-bottom:10px;
      font-size:12px;
    }

    table.details{ width:100%; border-collapse:collapse; font-size:12px; }
    table.details th, table.details td {
      padding:6px 8px;
      border:1px solid #e9f1fb;
      text-align:left;
      vertical-align:top;
    }
    table.details th { background:#f7fbff; width:32%; font-weight:600; color:#374151; }

    .label {
      display:inline-block;
      padding:6px 10px;
      color:#fff;
      border-radius:4px;
      font-weight:700;
      font-size:12px;
    }
    .label.normal{ background:#16a34a; }
    .label.pneumonia{ background:#ef4444; }

    .img-wrap{ margin-top:6px; text-align:center; }
    img.xray{
      max-width:320px;
      max-height:360px;
      border:1px solid #e6eef8;
      display:block;
      margin:0 auto;
    }

    .footer {
      margin-top:14px;
      font-size:11px;
      color:#6b7280;
      border-top:1px solid #eef6ff;
      padding-top:8px;
    }

    /* simple responsive fallback when rendering to PDF engines - not used by xhtml2pdf but harmless */
    @media (max-width:480px){
      .left-col, .right-col { display:block; width:100%; }
      img.xray{ max-width:100%; height:auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <table class="header-table">
        <tr>
          <td style="width:72px;">
            <div class="logo" aria-hidden="true">PD</div>
          </td>
          <td style="padding-left:10px;">
            <div class="title">Pneumonia Report</div>
            <div class="sub">Report ID: {{ prediction.pk }} â€¢ {{ prediction.created_at|date:"Y-m-d H:i" }}</div>
            <div class="sub">Generated for: {{ prediction.patient_name|default:"-" }} {% if user.email %} ({{ user.email }}){% endif %}</div>
          </td>
          <td style="text-align:right; width:160px;">
            <div style="font-size:11px;color:#6b7280">Confidential</div>
          </td>
        </tr>
      </table>
    </div>

    <table class="content-table">
      <tr>
        <td class="left-col">
          <div class="box">
            <strong style="font-size:13px;">Patient details</strong>
            <div style="margin-top:6px; font-size:12px;">
              <div><strong>Name:</strong> {{ prediction.patient_name|default:"-" }}</div>
              <div><strong>Email:</strong> {{ prediction.patient_email|default:"-" }}</div>
            </div>
          </div>

          <table class="details" role="table" aria-label="Prediction details">
            <tr><th>Image filename</th><td>{{ prediction.image_name }}</td></tr>
            <tr>
              <th>Label</th>
              <td>
                <span class="label {% if prediction.label == 'Normal' %}normal{% else %}pneumonia{% endif %}">{{ prediction.label }}</span>
              </td>
            </tr>
            <tr><th>Probability</th><td>{{ prediction.probability|floatformat:4 }}</td></tr>
            <tr><th>Recorded</th><td>{{ prediction.created_at|date:"Y-m-d H:i" }}</td></tr>
          </table>

          <div style="margin-top:10px; font-size:12px;">
            <strong>Notes</strong>
            <div style="color:#6b7280; margin-top:6px; font-size:11px;">
              This report is generated by an automated classifier for demonstration purposes. It is not a medical diagnosis. Clinical correlation and expert review are required.
            </div>
          </div>
        </td>

        <td class="right-col">
          {% if prediction.image_name %}
          <div style="font-size:12px; color:#6b7280; margin-bottom:6px;">xray image</div>
          <div class="img-wrap">
            <!-- link_callback in view will convert MEDIA_URL to filesystem path for xhtml2pdf -->
            <img class="xray" src="{{ prediction.image_url }}" alt="X-ray image">
          </div>
          {% else %}
          <div style="font-size:12px;color:#6b7280;">No image available</div>
          {% endif %}
        </td>
      </tr>
    </table>

    <div class="footer">
      Report generated by Pneumonia Detector. For support, contact your administrator.
    </div>
  </div>
</body>
</html>